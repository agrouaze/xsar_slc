\documentclass[11 pt]{article}
\usepackage[nomarkers,nolists]{endfloat}
\usepackage[latin1]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx} 
\usepackage{epsfig}
\usepackage{geometry}
\usepackage{amssymb,amsmath}
\usepackage{psfrag,subfigure}
\usepackage{hyperref}
\usepackage{amssymb}

\topmargin -1.5cm      
\textheight=22cm
\textwidth=17cm
\evensidemargin 0.25cm
\oddsidemargin     0.25cm

\newcommand\nc\newcommand
\nc\be{\begin{equation}}
\nc\ee{\end{equation}}
\nc \vect \mathbf
\nc \ba{\begin{eqnarray}}
\nc\ea{\end{eqnarray}}
\nc\expo{\mbox{$\text{e}$}}
\nc\eye{\mbox{$\text{i}$}}


\begin{document}
\title{Algorithm Theoretical Basis Document\\Sentinel 1 - L1B SLC}
\author{Frédéric Nouguier, Alexis Mouche, Bertrand Chapron, Gilles Guitton, Antoire Grouazel, ...}
\date{\today}
\maketitle


\section{Computation of sublook cross-spectra (WV and IW products)}


\subsection{Deramping of digital numbers}

Lets call $DN(sample, line)$ the 2D matrix of RAW digital numbers with dimensions: sample (fast time) and line (slow time) provided in L1 SLC IW or WV products. Fast time is in the range direction and slow time is the azimuth direction. Due to the TOPS mode of IWS acquisition, it is mandatory to ``deramp'' the complex digital numbers in order to obtain meaningful complex values. The deramping procedure has to be applied to compensate for the antenna steering rate during the acquisition. The deramping procedure do not need to be applied for Wave Mode acquisitions because of the abscence of steering. The deramping procedure for IW acquisitions follows the steps described in the ESA Technical note COPE-GSEG-EOPG-TN-14-0025 : \href{https://sentinel.esa.int/documents/247904/1653442/sentinel-1-tops-slc_deramping}{``Definition of the TOPS SLC deramping function for products generated by the S-1 IPF''}

The deramped digital number writes:
\be
\overline{DN}=DN\expo^{\eye\phi}\qquad\text{with}\qquad\phi=-\pi k_t(\tau)(\eta-\eta_{ref})^2
\ee
Definition of $\phi$ and how to compute it from L1 SLC products is described in \href{https://sentinel.esa.int/documents/247904/1653442/sentinel-1-tops-slc_deramping}{ESA Technical note COPE-GSEG-EOPG-TN-14-0025}


\subsection{Complex modulation signal}

The SAR image cross-spectra is meant to quantify the spatial frequency content of the cross-section modulations. The modulations are the relative variation of the radar cross-section relatively to the ``mean radar cross section'' of the image. As we are interested with the frequency content due to wave modulation, we define the ``mean radar cross-section'' as the average of the radar cross-section over a prescribed image extension (typically 1 km x 1 km). It writes:
\be
I_{low} = |\overline{DN}|^2\star G
\ee
where $\star$ operators stands for the convolution and with $G$ a normalized Gaussian-filter with a customizable 1 km x 1 km standard deviations.
The complex Digital Number modulations thus writes:
\be
\label{DNmod}
\widetilde{DN} = \dfrac{\overline{DN}}{\sqrt{I_{low}}}
\ee


\subsection{Computation of azimuthal Doppler centroid}

Lets call $rg$ and $az$ as respectively the range and azimuth spatial vectors associated with the selected image. $rg = \text{sample}\times d_{rg}$ and $az = \text{line}\times d_{az}$ where $d_{rg}$ and $d_{az}$ are respectively the sample and line spacing in meters.
The azimuthal Doppler spectrum writes:
\be
D(rg,f_{az}) = \left|\int \widetilde{DN}(rg,az) e^{-i2\pi f_{az}az} d_{az}\right|^2
\label{dop}
\ee
The azimuthal Doppler centroid is the mean azimuth frequency of the azimuthal Doppler spectrum. In order to get a good estimation of the Doppler centroid, the average of the Doppler spectrum is computed on the range direction:
\be
\overline{D}(f_{az}) = \left\langle D(rg,f_{az})\right\rangle_{rg}
\ee
An example of Doppler spectrum is represented on figure \ref{fig:dopplerspectrum}.

\begin{figure}[!h]
\centering
\includegraphics[scale=0.4]{./figures/S1_azimuth_IR_IW_VV.png}
\caption{Azimuthal Doppler spectrum}
\label{fig:dopplerspectrum}
\end{figure}

The azimuthal Doppler centroid is, by definition, the mean (first order moment) of the Doppler spectrum, namely:
\be
\label{def:centroid}
DC \triangleq \dfrac{\int f_{az} \overline{D}(f_{az}) df_{az}}{\int\overline{D}(f_{az}) df_{az}}
\ee
However, since the azimuthal Doppler spectrum is not symmetric due to windowing processing applied during the generation of the L1 SLC the estimation of the DC using equation (\ref{def:centroid}) is biaised. In practise, the DC is computed by fitting a Gaussian curve on the Doppler spectrum to find the position of the maximum. This should be updated in the future.


\subsection{Computation of centered and normalized Doppler spectrum}


We noticed that the Doppler spectrum is not centered around zero nor symmetric relatively to its maximum. Several explanations can be given to explain this two characteristics. The not centered value of the azimuthal centroid can be due, among others, to some geophysical aspects such as the observed scene mean motion but also on some instrument uncorrected geometry and uncompensated antenna properties.
The disymmetric shape can also be due to some uncompensated instrument effect but also on applied signal processing such as windowing or interpolation. In order to correctly further process the Doppler spectrum, it is mandatory to compensate as much as possible these effects with a two step processing:
\begin{itemize}
    \item{centering the Doppler spectrum}
    \item{Normalize the Doppler spectrum by the Impulse Response of the instrument}
\end{itemize}

\subsubsection{Centering the Doppler spectrum}

Centering the Doppler spectrum and computing the 2D Fourier Transform of the complex modulation signal writes:

\be
FT^{2D}\left[\widetilde{DN}_c\right] = \int \widetilde{DN}(rg,az)\expo^{-i2\pi\ DC\ az} \expo^{-i2\pi (f_{az}az+f_{rg}rg} d_{az}d_{rg}\label{centereddop}
\ee


\subsubsection{Normalization of the Doppler spectrum by the Impulse Response of the instrument}


Figure \ref{fig:azimuthIR_IW} and \ref{fig:rangeIR_IW} respectively show the centered azimuthal and slant-range Impulse Response of Sentinel-1 in VV polarization for the three subswath IW.
Figure \ref{fig:azimuthIR_WV} and \ref{fig:rangeIR_WV} respectively show the centered azimuthal and slant-range Impulse Response of Sentinel-1 in VV polarization for the WV swath.
These Impulse Responses have been computed over homogeneous and motion-less surfaces, averaged and stored. The dataset used to compute theses response is avalibale here and the numerical code to produce them here.

\begin{figure}
\centering
\includegraphics[scale=0.4]{./figures/S1_azimuth_IR_IW_VV.png}
\caption{Azimuthal Impulse Response for IW subswathes in VV polarisation}
\label{fig:azimuthIR_IW}
\end{figure}

\begin{figure}
\centering
\includegraphics[scale=0.4]{./figures/S1_range_IR_IW_VV.png}
\caption{Range Impulse Response for IW subswathes in VV polarisation}
\label{fig:rangeIR_IW}
\end{figure}

\begin{figure}
\centering
\includegraphics[scale=0.4]{./figures/S1_azimuth_IR_WV_VV.png}
\caption{Azimuthal Impulse Response for WV mode in VV polarisation}
\label{fig:azimuthIR_WV}
\end{figure}

\begin{figure}
\centering
\includegraphics[scale=0.4]{./figures/S1_range_IR_WV_VV.png}
\caption{Range Impulse Response for WV mode in VV polarisation}
\label{fig:rangeIR_WV}
\end{figure}

The normalization with the instrument Impuse Response is realized in the Fourier domain and writes:

\be
FT^{2D}\left[\widetilde{\underline{DN_c}}\right](f_{rg},f_{az}) = \dfrac{FT^{2D}[\widetilde{DN}_c]}{\sqrt{IR_{rg}(f_{rg})}\sqrt{IR_{az}(f_{az})}}
\ee
with $IR_{rg}$ and $IR_{az}$ being the Impulse Response in range and azimuth direction for the considered acquisition mode.

\subsection{Extraction of azimuthal sublooks}

The extraction of azimuthal sublook is computed following the procedure:
\begin{itemize}
    \item{Taking the Inverse Fourier Transform of $FT^{2D}\left[\widetilde{\underline{DN_c}}\right]$ in the range direction.}
    \item{Slicing the returned azimuthal Doppler bandwidth into $n$ portions.}
    \item{Taking the Inverse Fourier Transform of each portion in the azimuthal direction.}
    \item{Normalizing each look energy.}
    \item{Detect the look}
\end{itemize}

They are evaluated as follow:

\be
FT^{1D}\left[\widetilde{\underline{DN_c}}\right](rg,f_{az}) = \dfrac{1}{2\pi}\int FT^{2D}\left[\widetilde{\underline{DN_c}}\right] \expo^{i2\pi f_{rg}rg} df_{rg}\
\ee
The second and third step corresponding to the extraction of look $i$ writes:

\be
\widetilde{\underline{DN_c}}^i(rg,az) = \dfrac{1}{2\pi}\int FT^{1D}\left[\widetilde{\underline{DN_c}}\right](rg,f_{az})W_i(f_{az}) \expo^{i2\pi f_{az}az} df_{az}\
\ee
where $W_i$ is the weighting function corresponding to slice $i$ in the azimuthal spectrum.
Figure \ref{} shows $\left|FT^{1D}\left[\widetilde{\underline{DN_c}}\right](rg,f_{az})\right|^2$ averaged over the range direction and the weighting function of a look.

Detecting look $i$ and normalizing its energy finally writes:

\be
look^i(rg,az)=\dfrac{\left|\widetilde{\underline{DN_c}}^i\right|^2}{\sum_{rg,az}{\left|\widetilde{\underline{DN_c}}^i\right|^2}}
\ee

In practice, the width of the slicing function $W_i$ is defined relatively to the total frequency range of the azimuthal Doppler spectrum. The baseline processing relies on a division into 3 looks and each look contains 25\% of the total Doppler frequency range. The remaining 25\% are located at the two borders of the frequency axis (12.5\% on each side).


\subsection{Sub-looks cross-spectra}


Cross-spectra between look $i$ and look $i+n$ writes:
\be
XS^{n\tau}(f_{rg},f_{az})=FT^{2D}[look^i]\cdot FT^{2D}[look^{i+n}]^\star
\ee

where the $\star$ symbol stands for the complex conjugate and where the definition of the 2D Fourier Transform $FT^{2D}$ is
\be
F(f_{rg},f_{az}) \triangleq FT^{2D}[f(rg,az)] = \iint f(rg,az) \expo^{-i2\pi(f_{az}az+f_{rg}rg)} d_{az}\ d_{rg}
\ee

The time separation ``$\tau$'' between two consecutive sublooks writes:
\be
\tau = SaD\times look_{sep}
\ee
where $SaD$ and $look_{sep}$ are respectively the Synthetic aperture Duration [second] and the look separation. They writes:
\ba
SaD &=& \dfrac{c\times s}{2f_{r}V_{sat} \Delta_{az}}\\
look_{sep} &=& look_{width}\times(1-look_{overlap})
\ea
with $c$, $s$, $f_r$, $V_{sat}$, $\Delta_{az}$ being respectively the speed of light, the slant range distance, the radar frequency, the satellite ground velocity and the azimuth spacing.
In the baseline processing, $look_{width}=0.2$ for IW, $look_{width}=0.25$ for WV and $look_{overlap}=0$.


\subsection{Periodograms}

In practice, to reduce noise on the computed cross-spectra, the steps above are applied on regions smaller than the full image (typically  2km X 2km) and then are averaged. A kind of Welsh methodology.

\section{Computation of the azimuthal cut-off}

The azimuthal cut-off is a characteristic distance defining the maximum wavelengh that the SAR was able to recover in the azimuth distance. It characterize its effective azimuthal resolution. The sea surface waves motion is responsible for a strong smeering in the azimuth direction. This smeering effect largely increases with the wave motion and is a good proxy for wind velocity.

The azimuthal cut-off is computed as follow.
\begin{itemize}
    \item{Computation of covariance function as the Inverse Fourier Transform of the cross-spectrum}
    \item{Averaging the covariance function on the range axis (or taking a transect)}
    \item{Normalize by it maximum}
    \item{Fit a Gaussian function and returns its standard deviation}
\end{itemize}

The covariance function writes:
\be
\rho(rg,az) = IFT^{2D}\left[\Re e(XS^{n\tau})\right)
\ee
where $\Re e$ stands for the real part and where $n=2$ in the baseline processing.
A Gaussian fit is applied on $\underline{\rho}(az) = \dfrac{\rho(rg=0, az)}{\rho(rg=0, az=0)}$ over the range span [-500,500] in the baseline processing. In the litterature, the Gaussian fit can also be done over the range averaged covariance function $\left\langle\rho(rg,az)\right\rangle_{rg}$.
The Gaussian fit is realized with a least square difference cost function and a gradient descent methodology. The azimuthal cut-off $\lambda$ is defined as the standard deviation of the fitted function:
\be
\exp\left(\dfrac{-az^2}{2\lambda^2}\right)
\ee

\section{Computation of calibrated denoised $\sigma^0$}

Sentinel-1 Level-1 SLC product contains radiometric calibration Look-Up table (LUT) and denoising LUT to compute the required quantity. This procedure is recalled in this
\href{https://sentinel.esa.int/documents/247904/685163/s1-radiometric-calibration-v1.0.pdf}{note} and detailled in this \href{https://sentinel.esa.int/documents/247904/2142675/Thermal-Denoising-of-Products-Generated-by-Sentinel-1-IPF}{document}. A short summerize recalled below can also be found \href{https://sentinel.esa.int/web/sentinel/radiometric-calibration-of-level-1-products}{here}

The radiometric calibration is applied by the following equation:
\be
value(i)=\dfrac{|DN_i|^2}{A_i^2}
\ee
where $value(i)$ can be $\beta^0(i)$, $\sigma^0(i)$ or $\gamma(i)$ depending of the used calibration table $A_i$ on the digital number $DN_i$. The $A_i$ LUT is provided at a lower resolution than the $DN$ and should thus be bilinearly interpolated.

The range and azimuth de-noise LUTs must be calibrated matching the radiometric calibration LUT applied to the DN as:
\be
noise^{rg/az}(i)=\dfrac{|\eta^{rg/az}_i|^2}{A_i^2}
\ee
where $\eta^{rg/az}_i$ are the range and azimuth noise LUTs and $noise^{rg/az}(i)$ are calibrated noise profiles depending on the used calibration table $A_i$.

The radiometrically calibrated and denoised $\sigma^0$ thus writes:
\be
\sigma^0(i)=\dfrac{DN_i^2-\eta^{rg}_i\eta^{az}_i}{\Sigma^0_i}
\ee
where $\eta^{rg}_i$, $\eta^{az}_i$ and $\Sigma^0_i$ are respectively the range noise, azimuth noise and calibration LUT interpolated over the Digital Number locations $i$. It can be noted that $\eta^{rg}_i$ is both range and azimuth dependent and $\eta^{az}_i$ is azimuth dependent.


\section{Computation of the sigma0 normalized variance}

The normalized variance is the variance of the Digital number defined over a prescribed spatial extension. In the baseline L1B SLC processor, the variance is computed at a tile level.

It writes:

\be
nv\triangleq\dfrac{\left\langle\left(m-\left\langle m\right\rangle\right)^2\right\rangle}{\left\langle m\right\rangle^2}
\ee
where $m=\left|\widetilde{DN}\right|^2$ and $\widetilde{DN}$ is defined in equation (\ref{DNmod})


\end{document}